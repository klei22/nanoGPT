# explorations/norm_wte_abs_sweep.yaml
---
# parameter_groups: define sets of overrides to apply on top of base params
parameter_groups:
  # baselines
  - tensorboard_run_name: ["baseline_abs_pos"]
    use_abs_pos_embeddings: [true]
    use_rotary_embeddings: [false]
  - tensorboard_run_name: ["baseline_rotary"]
    use_abs_pos_embeddings: [false]
    use_rotary_embeddings: [true]

  # with scale
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["20.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_l2_default_w_scale"]
  - norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["20.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["abs_l2_default_w_scale"]
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["20.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [false]
    norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["20.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_and_abs_default_w_scale"]

  # with scale and gain
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["20.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [true]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_l2_default_w_scale_and_gain"]
  - norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["20.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [true]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["abs_l2_default_w_scale_and_gain"]
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["20.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [true]
    norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["20.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [true]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_and_abs_default_w_scale_and_gain"]

  # With Radius Tests
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["1.0", "50.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [true, false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_l2_radius_tests"]
  - norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["1.0", "50.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [true, false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["abs_l2_radius_tests"]
  - norm_variant_wte: ["hyperspherenorm"]
    norm_wte_radius: ["1.0", "20.0", "50.0"]
    norm_wte_scale: ["1.0", "2.0", "5.0"]
    norm_wte_gain: [true, false]
    norm_variant_abs: ["hyperspherenorm"]
    norm_abs_radius: ["1.0", "20.0", "50.0"]
    norm_abs_scale: ["1.0", "2.0", "5.0"]
    norm_abs_gain: [true, false]
    use_abs_pos_embeddings: [true]
    tensorboard_run_name: ["wte_and_abs_radius_tests"]

# Collect Intermediate Activation Stats
compute_model_stats: [true]
print_model_stats: ["print_stats/${RUN_NAME}"]

use_qk_norm: [true]
use_qk_norm_scale: [true]
use_peri_ln: [true, false]

# base hyperparameters
max_iters: [5000]
eval_interval: [500]
n_layer: [6]
n_head: [6]
n_embd: [384]
block_size: [256]
device: ["cuda"]
dtype: ["bfloat16"]
dataset: ["minipile"]

# VRAM and Memory
compile: [true]
never_save_checkpoint: [true]

